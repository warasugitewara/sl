# SL - 蒸気機関車

Wezterm の透過背景に対応した、クラシック `sl` ターミナルアニメーションの Python 実装です。

元々の [mtoyoda/sl](https://github.com/mtoyoda/sl) (C言語版) に基づいています。

## 特徴

- **完全互換のアニメーション**: 元の `sl.c` の動作を完全に再現
  - 6フレームの車輪アニメーション
  - 16段階の煙パターンと放物線軌跡
  - 4フレームごとの煙更新で滑らかな連続アニメーション
  - 1フレーム 40ms（元の usleep(40000) と同じ）

- **Wezterm 透過背景対応**: ターミナルの透明度をそのまま表示
  - Windows 11 + Wezterm + Nushell + Starship で検証済み
  - ANSI エスケープシーケンスによる透明なレンダリング
  - ターミナルの美的向上に最適

- **ループアニメーション**: アニメーションを複数回再生可能
  - `-loop` : 無限ループ
  - `-loop N` : N回ループ（例: `-loop 3`）

## インストール

### 必要な環境
- Python 3.6 以上
- ANSI エスケープシーケンスをサポートするターミナル（Wezterm で動作確認）

### セットアップ

1. リポジトリをクローンまたはダウンロード
```bash
git clone https://github.com/yourusername/sl.git
cd sl
```

2. 実行可能にする
```bash
# Windows の場合
python sl.py

# またはシェルプロファイルにエイリアスを追加
```

## 使用方法

### 基本的な使い方
```bash
python sl.py
```

### ループアニメーション
```bash
# 無限ループ
python sl.py -loop

# 3回ループ
python sl.py -loop 3
```

### ヘルプ表示
```bash
python sl.py -h
```

## Wezterm 設定

透過背景を有効にするには、`wezterm.lua` に以下を追加してください：

```lua
config.window_background_opacity = 0.65

config.colors = {
    background = "rgba(0,0,0,0.65)",
}
```

## 技術詳細

### Python 実装
このバージョンは元の C 実装の完全な Python 書き直しで、ピクセル完全なアニメーション互換性を保っています：

- **機関車グラフィック**: D51 蒸気機関車の 7 行 ASCII アート
- **炭車**: 車輪付き炭車の 8 行 ASCII アート
- **車輪アニメーション**: 6フレームの循環アニメーション
- **煙システム**:
  - 16 段階のアニメーション
  - dy/dx テーブルによる放物線の動的移動
  - 4 フレームごとの煙粒子更新
  - スムーズな見た目のための毎フレームの連続レンダリング
  - アニメーション完了時の自動クリーンアップ

### フレームタイミング
- 1 フレーム 40ms（元の C コードの 40,000 マイクロ秒）
- 煙の更新は `x % 4 == 0` のフレームで発生
- 煙は毎フレームレンダリングされて連続的な見た目を実現

### 元の実装との差分
- C 言語の curses ではなく Python 実装
- ncurses ではなく ANSI エスケープシーケンスを使用
- 最新のターミナルエミュレータ向け透過背景対応
- argparse によるコマンドライン引数解析

## コード構成

```
sl.py
├── 設定（パターン、色）
├── 描画関数（ANSI エスケープシーケンス）
├── Smoke クラス（アニメーション状態管理）
└── メインループ（機関車移動とレンダリング）
```

## ライセンス

元の `sl` の作者は Toyoda Masashi です。
詳細は [LICENSE](LICENSE) ファイルを参照してください。

## クレジット

- 元の作者: Toyoda Masashi (mtoyoda@acm.org)
- Python 実装: [mtoyoda/sl](https://github.com/mtoyoda/sl) にインスピレーションを受けました
- Wezterm 透過背景対応

## トラブルシューティング

### 煙がチカチカして見える
- ターミナルが ANSI エスケープシーケンスをサポートしていることを確認してください
- Wezterm の不透明度設定を調整してみてください

### アニメーションがぎくしゃくして見える
- Python が互換性モードで実行されていないことを確認してください
- 他のプロセスが CPU を多く使用していないことを確認してください

### 透過背景が機能しない
- Wezterm の設定に不透明度設定が含まれていることを確認してください
- 設定変更後、Wezterm を再起動してください
- ターミナルの背景が実際に OS の設定で透明になっていることを確認してください

## 貢献

このリポジトリをフォークして、改善のためのプルリクエストを送信してください！
